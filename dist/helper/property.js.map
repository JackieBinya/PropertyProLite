{"version":3,"sources":["../../src/helper/property.js"],"names":["properties","validate","req","schema","price","Joi","number","required","min","state","string","max","city","address","type","image_url","body","strictValidate","regex","keys","Object","key","includes","test","error","isNaN","update","property","validateUpdate","saveProperty","_","pick","id","length","owner","user","status","created_on","Date","toLocaleString","push","updatePropertyHelper","forEach","deletePropertyHelper","index","indexOf","splice","message"],"mappings":"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","sourcesContent":["import Joi from 'joi';\r\nimport _ from \"lodash\";\r\nimport isUrl from 'is-url';\r\n\r\nconst properties = [];\r\n\r\nexport const validate = (req) => {\r\n  const schema = {\r\n    price: Joi.number().required().min(1000),\r\n    state: Joi.string().required().min(1).max(255),\r\n    city: Joi.string().required().min(1).max(255),\r\n    address: Joi.string().required().min(1).max(255),\r\n    type: Joi.string().required().min(1).max(255),\r\n    image_url: Joi.string().required(),\r\n  };\r\n\r\n  return Joi.validate(req.body, schema);\r\n}\r\n\r\nexport const strictValidate = (req) => {\r\n  const regex = /^[A-Za-z0-9 ]+$/;\r\n  let keys = Object.keys(req.body);\r\n\r\n  for (let key of keys) {\r\n    if (!['price', 'image_url'].includes(key)) {\r\n      if (!regex.test(req.body[`${key}`])) return { error: `${key} should not have special characters` }\r\n      if (!isNaN(req.body[`${key}`])) return { error: `${key} should not be a number` };\r\n    }\r\n  }\r\n\r\n  if (req.update) {\r\n    if(req.body.image_url) {\r\n      if (!isUrl(req.body.image_url)) return { error: 'the url is invalid' }; \r\n    }\r\n  }\r\n  else {\r\n    if (!isUrl(req.body.image_url)) return { error: 'the url is invalid' }; \r\n  } \r\n\r\n  if(req.body.type) {\r\n    for(let property of properties) {\r\n      if(property.type == req.body.type) {\r\n        return { error: 'the house already exits' };\r\n      } \r\n    }\r\n  }\r\n}\r\n\r\nexport const validateUpdate = (req) => {\r\n  const schema = {\r\n    price: Joi.number().min(1000),\r\n    state: Joi.string().min(1).max(255),\r\n    city: Joi.string().min(1).max(255),\r\n    address: Joi.string().min(1).max(255),\r\n    type: Joi.string().min(1).max(255),\r\n    image_url: Joi.string()\r\n  }\r\n\r\n  return Joi.validate(req.body, schema);\r\n}\r\n\r\nexport const saveProperty = (req) => {\r\n  const property = _.pick(req.body, ['price', 'state', 'city', 'address', 'type', 'image_url']);\r\n  property.id = properties.length + 1;\r\n  property.owner = req.user.id;\r\n  property.status = 'available';\r\n  property.created_on = new Date().toLocaleString();\r\n\r\n  properties.push(property);\r\n\r\n  return property;\r\n}\r\n\r\nexport const updatePropertyHelper = (property, req) => {\r\n  const keys = Object.keys(property);\r\n  keys.forEach((key) => {\r\n    if (!['id', 'owner', 'status', 'created_on'].includes(key) && req.body[`${key}`])\r\n      property[`${key}`] = req.body[`${key}`];\r\n  });\r\n\r\n  return property;\r\n}\r\n\r\nexport const deletePropertyHelper = (property) => {\r\n  const index = properties.indexOf(property);\r\n  properties.splice(index, 1);\r\n\r\n  property = {};\r\n  property.message = 'Deleted property successfully';\r\n\r\n  return property;\r\n}\r\n\r\nexport { properties };\r\n"],"file":"property.js"}